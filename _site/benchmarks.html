<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Benchmarks - Z.Haskell</title> <link rel="shortcut icon" href="/docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Benchmarks | Z.Haskell</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Benchmarks" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="The document site for Haskell Project Z." /> <meta property="og:description" content="The document site for Haskell Project Z." /> <link rel="canonical" href="http://localhost:4000/docs/benchmarks.html" /> <meta property="og:url" content="http://localhost:4000/docs/benchmarks.html" /> <meta property="og:site_name" content="Z.Haskell" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Benchmarks" /> <script type="application/ld+json"> {"@type":"WebPage","url":"http://localhost:4000/docs/benchmarks.html","headline":"Benchmarks","description":"The document site for Haskell Project Z.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/docs/" class="site-title lh-tight"> Z.Haskell </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/docs/guide" class="nav-list-link">Guide</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Z-IO/" class="nav-list-link">Z-IO</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/Z-IO/Filesystem.html" class="nav-list-link">Filesystem</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/Z-Data/" class="nav-list-link">Z-Data</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/Z-Data/VectorAndArray.html" class="nav-list-link">Vector and Array</a></li></ul></li><li class="nav-list-item active"><a href="http://localhost:4000/docs/benchmarks.html" class="nav-list-link active">Benchmarks</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/blog.html" class="nav-list-link">Blog</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Z.Haskell" aria-label="Search Z.Haskell" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/ZHaskell" class="site-button" > GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#json-performance" id="markdown-toc-json-performance">JSON performance</a></li> <li><a href="#tcp-performance" id="markdown-toc-tcp-performance">TCP performance</a></li> </ol> <p>Benchmarks’ code are available on <a href="https://github.com/ZHaskell/benchmarks">Github</a>.</p> <p>Note benchmarks only record certain aspect of the code and the setup environment, they may not reflect real-world use-case. Any patches to improve the simulation as practical as possible are welcomed.</p> <h1 id="json-performance"> <a href="#json-performance" class="anchor-heading" aria-labelledby="json-performance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON performance </h1> <p>This benchmark compared <a href="https://hackage.haskell.org/package/Z-Data/docs/Z-Data-JSON.html">JSON module in Z-Data</a> with <a href="https://hackage.haskell.org/package/aeson">aeson</a>, a widely used JSON package on hackage. See our analysis in <a href="/docs/performance/2021/02/01/High-performance-JSON-codec.html">this blog post</a>.</p> <p><img src="https://github.com/ZHaskell/benchmarks/blob/master/json-benchmark/json-benchmark-result.png?raw=true" alt="bench-result" /></p> <h1 id="tcp-performance"> <a href="#tcp-performance" class="anchor-heading" aria-labelledby="tcp-performance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TCP performance </h1> <p>This benchmark compared different redis PING-PONG server implementations, using <code class="highlighter-rouge">redis-benchmark</code> tool from redis package running <code class="highlighter-rouge">redis-benchmark -p 8888 -t ping -n 100000 -q -c 100</code>.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Haskell's network package
# cabal run redis-benchmark-base -- +RTS -N4 -H2G
PING_INLINE: 88105.73 requests per second
PING_BULK: 87873.46 requests per second

# Z-IO from Z.Haskell
# cabal run redis-benchmark-z -- +RTS -N4 -H2G
PING_INLINE: 99800.40 requests per second
PING_BULK: 102459.02 requests per second

# Golang standard lib
PING_INLINE: 98716.68 requests per second
PING_BULK: 101522.84 requests per second

# Rust mio
PING_INLINE: 111731.84 requests per second
PING_BULK: 112612.61 requests per second

# C libuv
PING_INLINE: 109170.30 requests per second
PING_BULK: 105374.08 requests per second
</code></pre></div></div> <p>Note both mio and libuv using a single thread event loop and a shared buffer to receive <code class="highlighter-rouge">redis-benchmark</code>’s messages between different connection, which is quite different from other lightweight thread based implementations.</p> <p>GHC also provides memory statistics:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Haskell's network package
# cabal run redis-benchmark-base -- +RTS -N4 -s -H2G
 3,751,313,096 bytes allocated in the heap
     302,793,568 bytes copied during GC
       1,869,864 bytes maximum residency (1044 sample(s))
         490,016 bytes maximum slop
            2085 MiB total memory in use (0 MB lost due to fragmentation)

                                     Tot time (elapsed)  Avg pause  Max pause
  Gen  0      2085 colls,  2085 par    0.455s   0.131s     0.0001s    0.0085s
  Gen  1      1044 colls,  1043 par    0.419s   0.149s     0.0001s    0.0226s

  Parallel GC work balance: 82.10% (serial 0%, perfect 100%)

  TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)

  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)

  INIT    time    0.001s  (  0.001s elapsed)
  MUT     time    5.360s  (  5.842s elapsed)
  GC      time    0.874s  (  0.280s elapsed)
  EXIT    time    0.001s  (  0.008s elapsed)
  Total   time    6.236s  (  6.130s elapsed)

  Alloc rate    699,915,737 bytes per MUT second

  Productivity  85.9% of total user, 95.3% of total elapsed

# Z-IO from Z.Haskell
# cabal run redis-benchmark-z -- +RTS -N4 -s -H2G
 280,828,448 bytes allocated in the heap
         835,688 bytes copied during GC
       3,375,112 bytes maximum residency (4 sample(s))
         839,672 bytes maximum slop
            2084 MiB total memory in use (0 MB lost due to fragmentation)

                                     Tot time (elapsed)  Avg pause  Max pause
  Gen  0         5 colls,     5 par    0.009s   0.008s     0.0015s    0.0073s
  Gen  1         4 colls,     3 par    0.023s   0.021s     0.0052s    0.0194s

  Parallel GC work balance: 82.81% (serial 0%, perfect 100%)

  TASKS: 14 (1 bound, 13 peak workers (13 total), using -N4)

  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)

  INIT    time    0.001s  (  0.001s elapsed)
  MUT     time    2.811s  (  6.757s elapsed)
  GC      time    0.032s  (  0.028s elapsed)
  EXIT    time    0.002s  (  0.004s elapsed)
  Total   time    2.846s  (  6.790s elapsed)

  Alloc rate    99,903,441 bytes per MUT second

  Productivity  98.8% of total user, 99.5% of total elapsed
</code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0"><p><a href="#top" id="back-to-top">Back to top</a></p>Copyright &copy; 2017-2020 Z.Haskell contributors. Distributed by a <a href="https://github.com/ZHaskell/Z/tree/master/LICENSE.txt">BSD license.</a></p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Zhaskell/docs/tree/master//benchmarks.md" id="edit-this-page">Edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
